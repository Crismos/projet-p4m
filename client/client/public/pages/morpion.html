
<div id="game">
	<canvas id="morpion_canvas" width="1920" height="900"></canvas>
</div>


<script>

function Morpion(){
	this.grid = new Grid(this);
	this.mouseEvent = new MouseEvent(this);
}

function Grid(morp){
	var i = 0, j = 0;
	var lineNumber = 9;//nb lignes
	var columnNumber = 9;//nb colonnes
	var canvas = document.getElementById("morpion_canvas");	
	var ctx = canvas.getContext("2d");
	var position = {x:200,y:20};//permet de positionner la grille à partir du coin en haut a gauche
	var size = {width : 750, height:750};//taille de la grille
	var cell = {width : (size.width / columnNumber), height : (size.height / lineNumber)};//hauteur et largeur d'une cellule
	var cells = [];//tab des cellules
	var cellHover = false;//la cellule qui est en surbrillance si on passe la souris dessus
	var highlightedSquare = new Image();
	highlightedSquare.src= 'highlightedSquare.png';

	for(i=0; i<columnNumber; i++){
		cells[i] = [];
 		for(j=0;j<lineNumber;j++){ 	
 			cells[i][j]=new Cell((cell.width*i+position.x),(cell.height*j+position.y),cell.width,cell.height); 			
 		}
 	}

	this.draw = function(){	

 		ctx.clearRect(0, 0, canvas.width, canvas.height);

 		for (i = 0; i < columnNumber; i++) {
 			for(j = 0; j < lineNumber; j++){
 				cells[i][j].draw(ctx);
 			}
 		} 			

 		//on dessine la cellule en surbrillance si celle-ci elle existe et est vide
 		if(cellHover && cells[cellHover.column][cellHover.line].getValue() == 0){
			ctx.beginPath();
			ctx.drawImage(highlightedSquare,cellHover.column*cell.width+position.x, 
				cellHover.line*cell.height+position.y, 
				cell.width, 
				cell.height);
			ctx.closePath();
 		}

 		//cest propriété sers à régler l'épaisseur du trait
 		ctx.lineWidth=6; 		
 		//on trace les ligne et colonnes et contours
 		for(j=0;j<=lineNumber;j++){
 			ctx.beginPath();
			ctx.moveTo(position.x,j*cell.height+position.y);
			ctx.lineTo(columnNumber*cell.width+position.x,j*cell.height+position.y);
			ctx.strokeStyle = "rgb(116,70,21)";
			ctx.stroke();
			ctx.closePath();
 		}
  		for(j=0;j<=columnNumber;j++){
  			ctx.beginPath();
			ctx.moveTo(j*cell.width+position.x,position.y);
			ctx.lineTo(j*cell.width+position.x,lineNumber*cell.height+position.y);
			ctx.strokeStyle = "rgb(116,70,21)";
			ctx.stroke();
			ctx.closePath();
 		}
 		if(lineNumber == 9 && columnNumber == 9){

 			ctx.lineWidth=10; 		

 			for(i = 0; i <4; i++){
 				ctx.beginPath();
 				ctx.moveTo(position.x+i*3*cell.width,position.y);
 				ctx.lineTo(position.x+i*3*cell.width,position.y+9*cell.height); 		
 				ctx.strokeStyle = "rgb(70,43,13)";
 				ctx.stroke();
 				ctx.closePath();
 			}

 			for(i = 0; i <4; i++){
 				ctx.beginPath();
 				ctx.moveTo(position.x,position.y+i*3*cell.height);
 				ctx.lineTo(position.x+9*cell.width,position.y+i*3*cell.height); 		
 				ctx.strokeStyle = "rgb(70,43,13)";
 				ctx.stroke();
 				ctx.closePath();
 			}
 			

 		}
	};


	//donne false si la souris est hors de la grille, sinon donne la la cellule en identifiant ligne et colonne (les lignes et colonnes partent de 0)
	this.getMouseCell = function(evt){
		var rect = canvas.getBoundingClientRect();
    	var pos =  {
    	  			x: evt.clientX - rect.left - position.x,
   		   			y: evt.clientY - rect.top - position.y
   				};

   		var celltmp = {column:Math.floor(pos.x/cell.width),line:Math.floor(pos.y/cell.height)};
    	if(pos.x >= 0 && pos.y >=0 && pos.x <= size.width && pos.y <= size.height){
    		return celltmp;
   		}else{
    		return false;
    	}
	};

	this.setCellHover = function(cell){
		cellHover = cell;
	}

	this.getCells = function(){
		return cells;
	}



} 

function Cell(x, y, width, height){

	var x = x;
	var y = y;
	var width = width;
	var height = height;

	var value = 0;
	/*DOC
	0-->CASE VIDE
	1-->CASE JOUE AVEC UN ROND
	2-->CASE JOUE AVEC UNE CROIX
	*/

	var cross = new Image();
	cross.src = 'cross.png';
	var circle = new Image();
	circle.src = 'circle.png';

	this.draw = function(ctx){
 		ctx.beginPath();
		ctx.rect(x,y,width,height);
		ctx.fillStyle = "rgb(234,178,118)";
		ctx.fill();
		ctx.closePath();
		if(value == 1){
			ctx.drawImage(circle,x+10,y+10,width-20,height-20);
		}else if(value == 2){
			ctx.drawImage(cross,x+10,y+10,width-20,height-20);
		}
	};
	this.setValue = function(nv_value){
		value = nv_value;
	};
	this.getValue = function(){
		return value;
	};
}

//jai créé un object pour les event histoire de faire un peu plus propre
function MouseEvent(morpion){	
	var morpion = morpion;
	var statique = 0;

	this.click = function(evt){		
		var pos = morpion.grid.getMouseCell(evt);
		//evite de changer une case déjà attribuée.
		
		if(morpion.grid.getCells()[pos.column][pos.line].getValue()!=0){
			return;
		}
		if(statique%2 == 0){
			morpion.grid.getCells()[pos.column][pos.line].setValue(1);
		}else{
			morpion.grid.getCells()[pos.column][pos.line].setValue(2);
		}
		morpion.grid.draw();
		statique = statique + 1;
	};

	this.move = function(evt){
		morpion.grid.setCellHover(morpion.grid.getMouseCell(evt));
		morpion.grid.draw();
	};
}

function init(){
	morpion = new Morpion();
	morpion.grid.draw();

	document.getElementById("morpion_canvas").onclick = function(e){
		morpion.mouseEvent.click(e);
	};
	document.getElementById("morpion_canvas").onmousemove = function(e){
		morpion.mouseEvent.move(e);
	};
}

init();

</script>