
<div id="game">
	<canvas id="morpion_canvas" width="1920" height="900"></canvas>

</div>


<script>

function Morpion(){
	//object représentant le jeu du morpion, cette objet est composé pour l'instant du canvas, d'une grille et d'un classe qui gère les évènement
	this.canvas = document.getElementById("morpion_canvas");	
	this.lineNumber = 3;//nb nignes
	this.columnNumber = 3;//nb colonnes
	this.grid = new Grid(this);
	this.mouseEvent = new MouseEvent(this);

	this.values = [];
	/*DOC
	0-->CASE VIDE
	1-->CASE JOUE AVEC UN ROND
	2-->CASE JOUE AVEC UNE CROIX
	la grille sera passer au server et uniquement à partir de celle-ci il pourra déduire si la partie est terminée et qui a gagné.
	*/
	//initialisation de la grille
	var i = 0, j = 0;
	for(i = 0; i<this.lineNumber;i++){
		this.values[i] = [];
		for(j=0;j<this.columnNumber;j++){
			this.values[i][j] = 0;
		}
	}
}

function Grid(morpion){
	//les propriété de la grille sont des trucs de css rien d'important que pourrais utiliser les sockets
	this.morpion = morpion;
	this.position = {x:200,y:20};//permet de positionner la grille à partir du coin en haut a gauche
	this.size = {width : 450, height:450};//taille de la grille

	this.style = {borderColor:"rgb(116,70,21)",lineWidth:6,backgroundColor:"rgb(234,178,118)"};
	this.cell = {width : (this.size.width / this.morpion.columnNumber), height : (this.size.height / this.morpion.lineNumber)}//hauteur et largeur d'une cellule, déterminé à partir de la taille de la grille et du nombre de lignes colonnes
	this.cellHover = false;//la cellule qui est en surbrillance si on pointe dessus
	this.highlightedSquare = new Image();
	this.highlightedSquare.src= 'highlightedSquare.png';
	this.cross = new Image();
	this.cross.src = 'cross.png';
	this.circle = new Image();
	this.circle.src = 'circle.png';
	this.ctx = this.morpion.canvas.getContext("2d");


	this.draw = function(){	
		var i = 0,j =0;
 		this.ctx.clearRect(0, 0, this.morpion.canvas.width, this.morpion.canvas.height);

		//on dessine chaque carré, pour linstant cest aussi rapide de dessiner un gros carré mais si on veut mettre une image stylé ou alterner les couleur ca peut etre utile.
		for(i=0; i<this.morpion.columnNumber; i++){
 			for(j=0;j<this.morpion.lineNumber;j++){ 	
 				this.ctx.beginPath();
				this.ctx.rect((this.cell.width*i+this.position.x),(this.cell.height*j+this.position.y),this.cell.width,this.cell.height);
				this.ctx.fillStyle = this.style.backgroundColor;
				this.ctx.fill();
				this.ctx.closePath();
 				//on remplit un rect avec sa position x,y et sa largeur, hauteur, cest pas comme sur android
 			}
 		}

 		//on dessine la cellule en surbrillance(si la souris pointe sur la grille), ca pu la merde la pcq il n y a pas de transparence .. mais osef
 		if(this.cellHover && this.morpion.values[this.cellHover.column][this.cellHover.line] == 0){
			this.ctx.beginPath();
			this.ctx.drawImage(this.highlightedSquare,this.cellHover.column*this.cell.width+this.position.x, 
				this.cellHover.line*this.cell.height+this.position.y, 
				this.cell.width, 
				this.cell.height);
			this.ctx.closePath();
 		}
 		for(i = 0; i<this.morpion.lineNumber;i++){
			for(j=0;j<this.morpion.columnNumber;j++){
				
				if(this.morpion.values[i][j] == 1){
					this.ctx.beginPath();
					console.log("b");
					this.ctx.drawImage(this.circle,(this.cell.width*i+this.position.x),(this.cell.height*j+this.position.y),this.cell.width,this.cell.height);
					this.ctx.closePath();
				}else if(this.morpion.values[i][j] == 2){
					this.ctx.beginPath();
					this.ctx.drawImage(this.cross,(this.cell.width*i+this.position.x),(this.cell.height*j+this.position.y),this.cell.width,this.cell.height);
					this.ctx.closePath();
				}
				
			}
		}

 		//cest propriété sers à régler l'épaisseur du trait
 		this.ctx.lineWidth=this.style.lineWidth; 		
 		//on trace les ligne et colonnes et contours
 		for(j=0;j<=this.morpion.lineNumber;j++){
 			this.ctx.beginPath();
			this.ctx.moveTo(this.position.x,j*this.cell.height+this.position.y);
			this.ctx.lineTo(this.morpion.columnNumber*this.cell.width+this.position.x,j*this.cell.height+this.position.y);
			this.ctx.strokeStyle = this.style.borderColor;
			this.ctx.stroke();
			this.ctx.closePath();
 		}
  		for(j=0;j<=this.morpion.columnNumber;j++){
  			this.ctx.beginPath();
			this.ctx.moveTo(j*this.cell.width+this.position.x,this.position.y);
			this.ctx.lineTo(j*this.cell.width+this.position.x,this.morpion.lineNumber*this.cell.height+this.position.y);
			this.ctx.stroke();
			this.ctx.closePath();
 		}
	};


	//donne false si la souris est hors de la grille, sinon donne la la cellule en identifiant ligne et colonne (les lignes et colonnes partent de 0)
	this.getGridMousePos = function(evt){
		var rect = this.morpion.canvas.getBoundingClientRect();
    	var pos =  {
    	  			x: evt.clientX - rect.left - this.position.x,
   		   			y: evt.clientY - rect.top -this.position.y
   				};

   		var cell = {column:Math.floor(pos.x/this.morpion.grid.cell.width),line:Math.floor(pos.y/this.morpion.grid.cell.height)};
    	if(pos.x >= 0 && pos.y >=0 && pos.x <= this.size.width && pos.y <= this.size.height){
    		return cell;
   		}else{
    		return false;
    	}
	};


} 

//jai créé un object pour les event histoire de faire un peu plus propre
function MouseEvent(morpion){
	this.morpion = morpion;
	MouseEvent.statique = 0;
	this.click = function(evt){
		
		var pos = this.morpion.grid.getGridMousePos(evt);
		if(this.morpion.values[pos.column][pos.line]!=0){
			return;
		}
		if(MouseEvent.statique%2 == 0){
			this.morpion.values[pos.column][pos.line] = 1;
		}else{
			this.morpion.values[pos.column][pos.line] = 2;
		}
		this.morpion.grid.draw();
		MouseEvent.statique = MouseEvent.statique + 1;
	};

	this.move = function(evt){
		this.morpion.grid.cellHover = this.morpion.grid.getGridMousePos(evt);
		this.morpion.grid.draw();
	};
}

function init(){
	morpion = new Morpion();
		morpion.grid.draw();

	morpion.canvas.onclick = function(e){
		morpion.mouseEvent.click(e);
	};
	morpion.canvas.onmousemove = function(e){
		morpion.mouseEvent.move(e);
	};
}

init();

</script>